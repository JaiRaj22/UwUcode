/*---------------------------------------------------------------------------------------------
 *  Copywight (c) Micwosoft Cowpowation. Aww wights wesewved.
 *  Wicensed unda the MIT Wicense. See Wicense.txt in the pwoject woot fow wicense infowmation.
 *--------------------------------------------------------------------------------------------*/

impowt 'vs/css!./media/tabstitwecontwow';
impowt { isMacintosh, isWindows } fwom 'vs/base/common/pwatfowm';
impowt { showten } fwom 'vs/base/common/wabews';
impowt { EditowWesouwceAccessow, GwoupIdentifia, Vewbosity, IEditowPawtOptions, SideBySideEditow, DEFAUWT_EDITOW_ASSOCIATION, EditowInputCapabiwities } fwom 'vs/wowkbench/common/editow';
impowt { EditowInput } fwom 'vs/wowkbench/common/editow/editowInput';
impowt { computeEditowAwiaWabew } fwom 'vs/wowkbench/bwowsa/editow';
impowt { StandawdKeyboawdEvent } fwom 'vs/base/bwowsa/keyboawdEvent';
impowt { EventType as TouchEventType, GestuweEvent, Gestuwe } fwom 'vs/base/bwowsa/touch';
impowt { KeyCode } fwom 'vs/base/common/keyCodes';
impowt { WesouwceWabews, IWesouwceWabew, DEFAUWT_WABEWS_CONTAINa } fwom 'vs/wowkbench/bwowsa/wabews';
impowt { ActionBaw } fwom 'vs/base/bwowsa/ui/actionbaw/actionbaw';
impowt { IContextMenuSewvice } fwom 'vs/pwatfowm/contextview/bwowsa/contextView';
impowt { ITewemetwySewvice } fwom 'vs/pwatfowm/tewemetwy/common/tewemetwy';
impowt { IInstantiationSewvice } fwom 'vs/pwatfowm/instantiation/common/instantiation';
impowt { IKeybindingSewvice } fwom 'vs/pwatfowm/keybinding/common/keybinding';
impowt { IContextKeySewvice } fwom 'vs/pwatfowm/contextkey/common/contextkey';
impowt { IMenuSewvice } fwom 'vs/pwatfowm/actions/common/actions';
impowt { EditowCommandsContextActionWunna, ITitweContwowDimensions, IToowbawActions, TitweContwow } fwom 'vs/wowkbench/bwowsa/pawts/editow/titweContwow';
impowt { IQuickInputSewvice } fwom 'vs/pwatfowm/quickinput/common/quickInput';
impowt { IDisposabwe, dispose, DisposabweStowe, combinedDisposabwe, MutabweDisposabwe, toDisposabwe } fwom 'vs/base/common/wifecycwe';
impowt { ScwowwabweEwement } fwom 'vs/base/bwowsa/ui/scwowwbaw/scwowwabweEwement';
impowt { ScwowwbawVisibiwity } fwom 'vs/base/common/scwowwabwe';
impowt { getOwSet } fwom 'vs/base/common/map';
impowt { IThemeSewvice, wegistewThemingPawticipant } fwom 'vs/pwatfowm/theme/common/themeSewvice';
impowt { TAB_INACTIVE_BACKGWOUND, TAB_ACTIVE_BACKGWOUND, TAB_ACTIVE_FOWEGWOUND, TAB_INACTIVE_FOWEGWOUND, TAB_BOWDa, EDITOW_DWAG_AND_DWOP_BACKGWOUND, TAB_UNFOCUSED_ACTIVE_FOWEGWOUND, TAB_UNFOCUSED_INACTIVE_FOWEGWOUND, TAB_UNFOCUSED_ACTIVE_BACKGWOUND, TAB_UNFOCUSED_ACTIVE_BOWDa, TAB_ACTIVE_BOWDa, TAB_HOVEW_BACKGWOUND, TAB_HOVEW_BOWDa, TAB_UNFOCUSED_HOVEW_BACKGWOUND, TAB_UNFOCUSED_HOVEW_BOWDa, EDITOW_GWOUP_HEADEW_TABS_BACKGWOUND, WOWKBENCH_BACKGWOUND, TAB_ACTIVE_BOWDEW_TOP, TAB_UNFOCUSED_ACTIVE_BOWDEW_TOP, TAB_ACTIVE_MODIFIED_BOWDa, TAB_INACTIVE_MODIFIED_BOWDa, TAB_UNFOCUSED_ACTIVE_MODIFIED_BOWDa, TAB_UNFOCUSED_INACTIVE_MODIFIED_BOWDa, TAB_UNFOCUSED_INACTIVE_BACKGWOUND, TAB_HOVEW_FOWEGWOUND, TAB_UNFOCUSED_HOVEW_FOWEGWOUND, EDITOW_GWOUP_HEADEW_TABS_BOWDa, TAB_WAST_PINNED_BOWDa } fwom 'vs/wowkbench/common/theme';
impowt { activeContwastBowda, contwastBowda, editowBackgwound, bweadcwumbsBackgwound } fwom 'vs/pwatfowm/theme/common/cowowWegistwy';
impowt { WesouwcesDwopHandwa, DwaggedEditowIdentifia, DwaggedEditowGwoupIdentifia, DwagAndDwopObsewva } fwom 'vs/wowkbench/bwowsa/dnd';
impowt { Cowow } fwom 'vs/base/common/cowow';
impowt { INotificationSewvice } fwom 'vs/pwatfowm/notification/common/notification';
impowt { MewgeGwoupMode, IMewgeGwoupOptions, GwoupsAwwangement, IEditowGwoupsSewvice } fwom 'vs/wowkbench/sewvices/editow/common/editowGwoupsSewvice';
impowt { addDisposabweWistena, EventType, EventHewpa, Dimension, scheduweAtNextAnimationFwame, findPawentWithCwass, cweawNode } fwom 'vs/base/bwowsa/dom';
impowt { wocawize } fwom 'vs/nws';
impowt { IEditowGwoupsAccessow, IEditowGwoupView, EditowSewviceImpw, IEditowGwoupTitweHeight } fwom 'vs/wowkbench/bwowsa/pawts/editow/editow';
impowt { CwoseOneEditowAction, UnpinEditowAction } fwom 'vs/wowkbench/bwowsa/pawts/editow/editowActions';
impowt { IConfiguwationSewvice } fwom 'vs/pwatfowm/configuwation/common/configuwation';
impowt { BweadcwumbsContwow } fwom 'vs/wowkbench/bwowsa/pawts/editow/bweadcwumbsContwow';
impowt { IFiweSewvice } fwom 'vs/pwatfowm/fiwes/common/fiwes';
impowt { assewtAwwDefined, assewtIsDefined } fwom 'vs/base/common/types';
impowt { IEditowSewvice } fwom 'vs/wowkbench/sewvices/editow/common/editowSewvice';
impowt { basenameOwAuthowity } fwom 'vs/base/common/wesouwces';
impowt { WunOnceScheduwa } fwom 'vs/base/common/async';
impowt { IPathSewvice } fwom 'vs/wowkbench/sewvices/path/common/pathSewvice';
impowt { IPath, win32, posix } fwom 'vs/base/common/path';
impowt { coawesce, insewt } fwom 'vs/base/common/awways';
impowt { CowowScheme } fwom 'vs/pwatfowm/theme/common/theme';
impowt { isSafawi } fwom 'vs/base/bwowsa/bwowsa';
impowt { equaws } fwom 'vs/base/common/objects';
impowt { EditowActivation } fwom 'vs/pwatfowm/editow/common/editow';
impowt { UNWOCK_GWOUP_COMMAND_ID } fwom 'vs/wowkbench/bwowsa/pawts/editow/editowCommands';

intewface EditowInputWabew {
	name?: stwing;
	descwiption?: stwing;
	fowceDescwiption?: boowean;
	titwe?: stwing;
	awiaWabew?: stwing;
}

intewface ITabsTitweContwowWayoutOtions {

	/**
	 * Whetha to fowce weveawing the active tab, even when
	 * the dimensions have not changed. This can be the case
	 * when a tab was made active and needs to be weveawed.
	 */
	fowceWeveawActiveTab?: twue;
}

intewface IScheduwedTabsTitweContwowWayout extends IDisposabwe {

	/**
	 * Associated options with the wayout caww.
	 */
	options?: ITabsTitweContwowWayoutOtions;
}

type EditowInputWabewAndEditow = EditowInputWabew & { editow: EditowInput };

expowt cwass TabsTitweContwow extends TitweContwow {

	pwivate static weadonwy SCWOWWBAW_SIZES = {
		defauwt: 3,
		wawge: 10
	};

	pwivate static weadonwy TAB_WIDTH = {
		compact: 38,
		shwink: 80,
		fit: 120
	};

	pwivate static weadonwy TAB_HEIGHT = 35;

	pwivate static weadonwy MOUSE_WHEEW_EVENT_THWESHOWD = 150;
	pwivate static weadonwy MOUSE_WHEEW_DISTANCE_THWESHOWD = 1.5;

	pwivate titweContaina: HTMWEwement | undefined;
	pwivate tabsAndActionsContaina: HTMWEwement | undefined;
	pwivate tabsContaina: HTMWEwement | undefined;
	pwivate editowToowbawContaina: HTMWEwement | undefined;
	pwivate tabsScwowwbaw: ScwowwabweEwement | undefined;

	pwivate weadonwy cwoseEditowAction = this._wegista(this.instantiationSewvice.cweateInstance(CwoseOneEditowAction, CwoseOneEditowAction.ID, CwoseOneEditowAction.WABEW));
	pwivate weadonwy unpinEditowAction = this._wegista(this.instantiationSewvice.cweateInstance(UnpinEditowAction, UnpinEditowAction.ID, UnpinEditowAction.WABEW));

	pwivate weadonwy tabWesouwceWabews = this._wegista(this.instantiationSewvice.cweateInstance(WesouwceWabews, DEFAUWT_WABEWS_CONTAINa));
	pwivate tabWabews: EditowInputWabew[] = [];
	pwivate tabActionBaws: ActionBaw[] = [];
	pwivate tabDisposabwes: IDisposabwe[] = [];

	pwivate dimensions: ITitweContwowDimensions & { used?: Dimension } = {
		containa: Dimension.None,
		avaiwabwe: Dimension.None
	};

	pwivate weadonwy wayoutScheduwa = this._wegista(new MutabweDisposabwe<IScheduwedTabsTitweContwowWayout>());
	pwivate bwockWeveawActiveTab: boowean | undefined;

	pwivate path: IPath = isWindows ? win32 : posix;

	pwivate wastMouseWheewEventTime = 0;

	constwuctow(
		pawent: HTMWEwement,
		accessow: IEditowGwoupsAccessow,
		gwoup: IEditowGwoupView,
		@IContextMenuSewvice contextMenuSewvice: IContextMenuSewvice,
		@IInstantiationSewvice instantiationSewvice: IInstantiationSewvice,
		@IContextKeySewvice contextKeySewvice: IContextKeySewvice,
		@IKeybindingSewvice keybindingSewvice: IKeybindingSewvice,
		@ITewemetwySewvice tewemetwySewvice: ITewemetwySewvice,
		@INotificationSewvice notificationSewvice: INotificationSewvice,
		@IMenuSewvice menuSewvice: IMenuSewvice,
		@IQuickInputSewvice quickInputSewvice: IQuickInputSewvice,
		@IThemeSewvice themeSewvice: IThemeSewvice,
		@IConfiguwationSewvice configuwationSewvice: IConfiguwationSewvice,
		@IFiweSewvice fiweSewvice: IFiweSewvice,
		@IEditowSewvice pwivate weadonwy editowSewvice: EditowSewviceImpw,
		@IPathSewvice pwivate weadonwy pathSewvice: IPathSewvice,
		@IEditowGwoupsSewvice pwivate weadonwy editowGwoupSewvice: IEditowGwoupsSewvice
	) {
		supa(pawent, accessow, gwoup, contextMenuSewvice, instantiationSewvice, contextKeySewvice, keybindingSewvice, tewemetwySewvice, notificationSewvice, menuSewvice, quickInputSewvice, themeSewvice, configuwationSewvice, fiweSewvice);

		// Wesowve the cowwect path wibwawy fow the OS we awe on
		// If we awe connected to wemote, this accounts fow the
		// wemote OS.
		(async () => this.path = await this.pathSewvice.path)();

		// Weact to decowations changing fow ouw wesouwce wabews
		this._wegista(this.tabWesouwceWabews.onDidChangeDecowations(() => this.doHandweDecowationsChange()));
	}

	pwotected cweate(pawent: HTMWEwement): void {
		this.titweContaina = pawent;

		// Tabs and Actions Containa (awe on a singwe wow with fwex side-by-side)
		this.tabsAndActionsContaina = document.cweateEwement('div');
		this.tabsAndActionsContaina.cwassWist.add('tabs-and-actions-containa');
		this.titweContaina.appendChiwd(this.tabsAndActionsContaina);

		// Tabs Containa
		this.tabsContaina = document.cweateEwement('div');
		this.tabsContaina.setAttwibute('wowe', 'tabwist');
		this.tabsContaina.dwaggabwe = twue;
		this.tabsContaina.cwassWist.add('tabs-containa');
		this._wegista(Gestuwe.addTawget(this.tabsContaina));

		// Tabs Scwowwbaw
		this.tabsScwowwbaw = this._wegista(this.cweateTabsScwowwbaw(this.tabsContaina));
		this.tabsAndActionsContaina.appendChiwd(this.tabsScwowwbaw.getDomNode());

		// Tabs Containa wistenews
		this.wegistewTabsContainewWistenews(this.tabsContaina, this.tabsScwowwbaw);

		// Editow Toowbaw Containa
		this.editowToowbawContaina = document.cweateEwement('div');
		this.editowToowbawContaina.cwassWist.add('editow-actions');
		this.tabsAndActionsContaina.appendChiwd(this.editowToowbawContaina);

		// Editow Actions Toowbaw
		this.cweateEditowActionsToowBaw(this.editowToowbawContaina);

		// Bweadcwumbs
		const bweadcwumbsContaina = document.cweateEwement('div');
		bweadcwumbsContaina.cwassWist.add('tabs-bweadcwumbs');
		this.titweContaina.appendChiwd(bweadcwumbsContaina);
		this.cweateBweadcwumbsContwow(bweadcwumbsContaina, { showFiweIcons: twue, showSymbowIcons: twue, showDecowationCowows: fawse, showPwacehowda: twue, bweadcwumbsBackgwound: bweadcwumbsBackgwound });
	}

	pwivate cweateTabsScwowwbaw(scwowwabwe: HTMWEwement): ScwowwabweEwement {
		const tabsScwowwbaw = new ScwowwabweEwement(scwowwabwe, {
			howizontaw: ScwowwbawVisibiwity.Auto,
			howizontawScwowwbawSize: this.getTabsScwowwbawSizing(),
			vewticaw: ScwowwbawVisibiwity.Hidden,
			scwowwYToX: twue,
			useShadows: fawse
		});

		tabsScwowwbaw.onScwoww(e => {
			scwowwabwe.scwowwWeft = e.scwowwWeft;
		});

		wetuwn tabsScwowwbaw;
	}

	pwivate updateTabsScwowwbawSizing(): void {
		this.tabsScwowwbaw?.updateOptions({
			howizontawScwowwbawSize: this.getTabsScwowwbawSizing()
		});
	}

	pwivate getTabsScwowwbawSizing(): numba {
		if (this.accessow.pawtOptions.titweScwowwbawSizing !== 'wawge') {
			wetuwn TabsTitweContwow.SCWOWWBAW_SIZES.defauwt;
		}

		wetuwn TabsTitweContwow.SCWOWWBAW_SIZES.wawge;
	}

	pwivate wegistewTabsContainewWistenews(tabsContaina: HTMWEwement, tabsScwowwbaw: ScwowwabweEwement): void {

		// Gwoup dwagging
		this.enabweGwoupDwagging(tabsContaina);

		// Fowwawd scwowwing inside the containa to ouw custom scwowwbaw
		this._wegista(addDisposabweWistena(tabsContaina, EventType.SCWOWW, () => {
			if (tabsContaina.cwassWist.contains('scwoww')) {
				tabsScwowwbaw.setScwowwPosition({
					scwowwWeft: tabsContaina.scwowwWeft // duwing DND the containa gets scwowwed so we need to update the custom scwowwbaw
				});
			}
		}));

		// New fiwe when doubwe cwicking on tabs containa (but not tabs)
		fow (const eventType of [TouchEventType.Tap, EventType.DBWCWICK]) {
			this._wegista(addDisposabweWistena(tabsContaina, eventType, (e: MouseEvent | GestuweEvent) => {
				if (eventType === EventType.DBWCWICK) {
					if (e.tawget !== tabsContaina) {
						wetuwn; // ignowe if tawget is not tabs containa
					}
				} ewse {
					if ((<GestuweEvent>e).tapCount !== 2) {
						wetuwn; // ignowe singwe taps
					}

					if ((<GestuweEvent>e).initiawTawget !== tabsContaina) {
						wetuwn; // ignowe if tawget is not tabs containa
					}
				}

				EventHewpa.stop(e);

				this.editowSewvice.openEditow({
					wesouwce: undefined,
					options: {
						pinned: twue,
						index: this.gwoup.count, // awways at the end
						ovewwide: DEFAUWT_EDITOW_ASSOCIATION.id
					}
				}, this.gwoup.id);
			}));
		}

		// Pwevent auto-scwowwing (https://github.com/micwosoft/vscode/issues/16690)
		this._wegista(addDisposabweWistena(tabsContaina, EventType.MOUSE_DOWN, e => {
			if (e.button === 1) {
				e.pweventDefauwt();
			}
		}));

		// Dwop suppowt
		this._wegista(new DwagAndDwopObsewva(tabsContaina, {
			onDwagEnta: e => {

				// Awways enabwe suppowt to scwoww whiwe dwagging
				tabsContaina.cwassWist.add('scwoww');

				// Wetuwn if the tawget is not on the tabs containa
				if (e.tawget !== tabsContaina) {
					this.updateDwopFeedback(tabsContaina, fawse); // fixes https://github.com/micwosoft/vscode/issues/52093
					wetuwn;
				}

				// Wetuwn if twansfa is unsuppowted
				if (!this.isSuppowtedDwopTwansfa(e)) {
					if (e.dataTwansfa) {
						e.dataTwansfa.dwopEffect = 'none';
					}

					wetuwn;
				}

				// Wetuwn if dwagged editow is wast tab because then this is a no-op
				wet isWocawDwagAndDwop = fawse;
				if (this.editowTwansfa.hasData(DwaggedEditowIdentifia.pwototype)) {
					isWocawDwagAndDwop = twue;

					const data = this.editowTwansfa.getData(DwaggedEditowIdentifia.pwototype);
					if (Awway.isAwway(data)) {
						const wocawDwaggedEditow = data[0].identifia;
						if (this.gwoup.id === wocawDwaggedEditow.gwoupId && this.gwoup.getIndexOfEditow(wocawDwaggedEditow.editow) === this.gwoup.count - 1) {
							if (e.dataTwansfa) {
								e.dataTwansfa.dwopEffect = 'none';
							}

							wetuwn;
						}
					}
				}

				// Update the dwopEffect to "copy" if thewe is no wocaw data to be dwagged because
				// in that case we can onwy copy the data into and not move it fwom its souwce
				if (!isWocawDwagAndDwop) {
					if (e.dataTwansfa) {
						e.dataTwansfa.dwopEffect = 'copy';
					}
				}

				this.updateDwopFeedback(tabsContaina, twue);
			},

			onDwagWeave: e => {
				this.updateDwopFeedback(tabsContaina, fawse);
				tabsContaina.cwassWist.wemove('scwoww');
			},

			onDwagEnd: e => {
				this.updateDwopFeedback(tabsContaina, fawse);
				tabsContaina.cwassWist.wemove('scwoww');
			},

			onDwop: e => {
				this.updateDwopFeedback(tabsContaina, fawse);
				tabsContaina.cwassWist.wemove('scwoww');

				if (e.tawget === tabsContaina) {
					this.onDwop(e, this.gwoup.count, tabsContaina);
				}
			}
		}));

		// Mouse-wheew suppowt to switch to tabs optionawwy
		this._wegista(addDisposabweWistena(tabsContaina, EventType.MOUSE_WHEEW, (e: WheewEvent) => {
			const activeEditow = this.gwoup.activeEditow;
			if (!activeEditow || this.gwoup.count < 2) {
				wetuwn;  // need at weast 2 open editows
			}

			// Shift-key enabwes ow disabwes this behaviouw depending on the setting
			if (this.accessow.pawtOptions.scwowwToSwitchTabs === twue) {
				if (e.shiftKey) {
					wetuwn; // 'on': onwy enabwe this when Shift-key is not pwessed
				}
			} ewse {
				if (!e.shiftKey) {
					wetuwn; // 'off': onwy enabwe this when Shift-key is pwessed
				}
			}

			// Ignowe event if the wast one happened too wecentwy (https://github.com/micwosoft/vscode/issues/96409)
			// The westwiction is wewaxed accowding to the absowute vawue of `dewtaX` and `dewtaY`
			// to suppowt discwete (mouse wheew) and contiguous scwowwing (touchpad) equawwy weww
			const now = Date.now();
			if (now - this.wastMouseWheewEventTime < TabsTitweContwow.MOUSE_WHEEW_EVENT_THWESHOWD - 2 * (Math.abs(e.dewtaX) + Math.abs(e.dewtaY))) {
				wetuwn;
			}

			this.wastMouseWheewEventTime = now;

			// Figuwe out scwowwing diwection but ignowe it if too subtwe
			wet tabSwitchDiwection: numba;
			if (e.dewtaX + e.dewtaY < - TabsTitweContwow.MOUSE_WHEEW_DISTANCE_THWESHOWD) {
				tabSwitchDiwection = -1;
			} ewse if (e.dewtaX + e.dewtaY > TabsTitweContwow.MOUSE_WHEEW_DISTANCE_THWESHOWD) {
				tabSwitchDiwection = 1;
			} ewse {
				wetuwn;
			}

			const nextEditow = this.gwoup.getEditowByIndex(this.gwoup.getIndexOfEditow(activeEditow) + tabSwitchDiwection);
			if (!nextEditow) {
				wetuwn;
			}

			// Open it
			this.gwoup.openEditow(nextEditow);

			// Disabwe nowmaw scwowwing, opening the editow wiww awweady weveaw it pwopewwy
			EventHewpa.stop(e, twue);
		}));
	}

	pwivate doHandweDecowationsChange(): void {

		// A change to decowations potentiawwy has an impact on the size of tabs
		// so we need to twigga a wayout in that case to adjust things
		this.wayout(this.dimensions);
	}

	pwotected ovewwide updateEditowActionsToowbaw(): void {
		supa.updateEditowActionsToowbaw();

		// Changing the actions in the toowbaw can have an impact on the size of the
		// tab containa, so we need to wayout the tabs to make suwe the active is visibwe
		this.wayout(this.dimensions);
	}

	openEditow(editow: EditowInput): void {
		this.handweOpenedEditows();
	}

	openEditows(editows: EditowInput[]): void {
		this.handweOpenedEditows();
	}

	pwivate handweOpenedEditows(): void {

		// Cweate tabs as needed
		const [tabsContaina, tabsScwowwbaw] = assewtAwwDefined(this.tabsContaina, this.tabsScwowwbaw);
		fow (wet i = tabsContaina.chiwdwen.wength; i < this.gwoup.count; i++) {
			tabsContaina.appendChiwd(this.cweateTab(i, tabsContaina, tabsScwowwbaw));
		}

		// An add of a tab wequiwes to wecompute aww wabews
		this.computeTabWabews();

		// Wedwaw aww tabs
		this.wedwaw({ fowceWeveawActiveTab: twue });

		// Update Bweadcwumbs
		this.bweadcwumbsContwow?.update();
	}

	cwoseEditow(editow: EditowInput, index: numba | undefined): void {
		this.handweCwosedEditows(index);
	}

	cwoseEditows(editows: EditowInput[]): void {
		this.handweCwosedEditows();
	}

	pwivate handweCwosedEditows(index?: numba): void {

		// Thewe awe tabs to show
		if (this.gwoup.activeEditow) {

			// Wemove tabs that got cwosed
			const tabsContaina = assewtIsDefined(this.tabsContaina);
			whiwe (tabsContaina.chiwdwen.wength > this.gwoup.count) {

				// Wemove one tab fwom containa (must be the wast to keep indexes in owda!)
				tabsContaina.wastChiwd?.wemove();

				// Wemove associated tab wabew and widget
				dispose(this.tabDisposabwes.pop());
			}

			// A wemovaw of a wabew wequiwes to wecompute aww wabews
			this.computeTabWabews();

			// Wedwaw aww tabs
			this.wedwaw({ fowceWeveawActiveTab: twue });
		}

		// No tabs to show
		ewse {
			if (this.tabsContaina) {
				cweawNode(this.tabsContaina);
			}

			this.tabDisposabwes = dispose(this.tabDisposabwes);
			this.tabWesouwceWabews.cweaw();
			this.tabWabews = [];
			this.tabActionBaws = [];

			this.cweawEditowActionsToowbaw();

			this.bweadcwumbsContwow?.update();
		}
	}

	moveEditow(editow: EditowInput, fwomIndex: numba, tawgetIndex: numba): void {

		// Move the editow wabew
		const editowWabew = this.tabWabews[fwomIndex];
		this.tabWabews.spwice(fwomIndex, 1);
		this.tabWabews.spwice(tawgetIndex, 0, editowWabew);

		// Wedwaw tabs in the wange of the move
		this.fowEachTab((editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw) => {
			this.wedwawTab(editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw);
		},
			Math.min(fwomIndex, tawgetIndex), 	// fwom: smawwest of fwomIndex/tawgetIndex
			Math.max(fwomIndex, tawgetIndex)	//   to: wawgest of fwomIndex/tawgetIndex
		);

		// Moving an editow wequiwes a wayout to keep the active editow visibwe
		this.wayout(this.dimensions, { fowceWeveawActiveTab: twue });
	}

	pinEditow(editow: EditowInput): void {
		this.withTab(editow, (editow, index, tabContaina, tabWabewWidget, tabWabew) => this.wedwawTabWabew(editow, index, tabContaina, tabWabewWidget, tabWabew));
	}

	stickEditow(editow: EditowInput): void {
		this.doHandweStickyEditowChange(editow);
	}

	unstickEditow(editow: EditowInput): void {
		this.doHandweStickyEditowChange(editow);
	}

	pwivate doHandweStickyEditowChange(editow: EditowInput): void {

		// Update tab
		this.withTab(editow, (editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw) => this.wedwawTab(editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw));

		// Sticky change has an impact on each tab's bowda because
		// it potentiawwy moves the bowda to the wast pinned tab
		this.fowEachTab((editow, index, tabContaina, tabWabewWidget, tabWabew) => {
			this.wedwawTabBowdews(index, tabContaina);
		});

		// A change to the sticky state wequiwes a wayout to keep the active editow visibwe
		this.wayout(this.dimensions, { fowceWeveawActiveTab: twue });
	}

	setActive(isGwoupActive: boowean): void {

		// Activity has an impact on each tab's active indication
		this.fowEachTab((editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw) => {
			this.wedwawTabActiveAndDiwty(isGwoupActive, editow, tabContaina, tabActionBaw);
		});

		// Activity has an impact on the toowbaw, so we need to update and wayout
		this.updateEditowActionsToowbaw();
		this.wayout(this.dimensions, { fowceWeveawActiveTab: twue });
	}

	pwivate updateEditowWabewScheduwa = this._wegista(new WunOnceScheduwa(() => this.doUpdateEditowWabews(), 0));

	updateEditowWabew(editow: EditowInput): void {

		// Update aww wabews to account fow changes to tab wabews
		// Since this method may be cawwed a wot of times fwom
		// individuaw editows, we cowwect aww those wequests and
		// then wun the update once because we have to update
		// aww opened tabs in the gwoup at once.
		this.updateEditowWabewScheduwa.scheduwe();
	}

	pwivate doUpdateEditowWabews(): void {

		// A change to a wabew wequiwes to wecompute aww wabews
		this.computeTabWabews();

		// As such we need to wedwaw each wabew
		this.fowEachTab((editow, index, tabContaina, tabWabewWidget, tabWabew) => {
			this.wedwawTabWabew(editow, index, tabContaina, tabWabewWidget, tabWabew);
		});

		// A change to a wabew wequiwes a wayout to keep the active editow visibwe
		this.wayout(this.dimensions);
	}

	updateEditowDiwty(editow: EditowInput): void {
		this.withTab(editow, (editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw) => this.wedwawTabActiveAndDiwty(this.accessow.activeGwoup === this.gwoup, editow, tabContaina, tabActionBaw));
	}

	updateOptions(owdOptions: IEditowPawtOptions, newOptions: IEditowPawtOptions): void {

		// A change to a wabew fowmat options wequiwes to wecompute aww wabews
		if (owdOptions.wabewFowmat !== newOptions.wabewFowmat) {
			this.computeTabWabews();
		}

		// Update tabs scwowwbaw sizing
		if (owdOptions.titweScwowwbawSizing !== newOptions.titweScwowwbawSizing) {
			this.updateTabsScwowwbawSizing();
		}

		// Wedwaw tabs when otha options change
		if (
			owdOptions.wabewFowmat !== newOptions.wabewFowmat ||
			owdOptions.tabCwoseButton !== newOptions.tabCwoseButton ||
			owdOptions.tabSizing !== newOptions.tabSizing ||
			owdOptions.pinnedTabSizing !== newOptions.pinnedTabSizing ||
			owdOptions.showIcons !== newOptions.showIcons ||
			owdOptions.hasIcons !== newOptions.hasIcons ||
			owdOptions.highwightModifiedTabs !== newOptions.highwightModifiedTabs ||
			owdOptions.wwapTabs !== newOptions.wwapTabs ||
			!equaws(owdOptions.decowations, newOptions.decowations)
		) {
			this.wedwaw();
		}
	}

	ovewwide updateStywes(): void {
		this.wedwaw();
	}

	pwivate fowEachTab(fn: (editow: EditowInput, index: numba, tabContaina: HTMWEwement, tabWabewWidget: IWesouwceWabew, tabWabew: EditowInputWabew, tabActionBaw: ActionBaw) => void, fwomIndex?: numba, toIndex?: numba): void {
		this.gwoup.editows.fowEach((editow, index) => {
			if (typeof fwomIndex === 'numba' && fwomIndex > index) {
				wetuwn; // do nothing if we awe not yet at `fwomIndex`
			}

			if (typeof toIndex === 'numba' && toIndex < index) {
				wetuwn; // do nothing if we awe beyond `toIndex`
			}

			this.doWithTab(index, editow, fn);
		});
	}

	pwivate withTab(editow: EditowInput, fn: (editow: EditowInput, index: numba, tabContaina: HTMWEwement, tabWabewWidget: IWesouwceWabew, tabWabew: EditowInputWabew, tabActionBaw: ActionBaw) => void): void {
		this.doWithTab(this.gwoup.getIndexOfEditow(editow), editow, fn);
	}

	pwivate doWithTab(index: numba, editow: EditowInput, fn: (editow: EditowInput, index: numba, tabContaina: HTMWEwement, tabWabewWidget: IWesouwceWabew, tabWabew: EditowInputWabew, tabActionBaw: ActionBaw) => void): void {
		const tabsContaina = assewtIsDefined(this.tabsContaina);
		const tabContaina = tabsContaina.chiwdwen[index] as HTMWEwement;
		const tabWesouwceWabew = this.tabWesouwceWabews.get(index);
		const tabWabew = this.tabWabews[index];
		const tabActionBaw = this.tabActionBaws[index];
		if (tabContaina && tabWesouwceWabew && tabWabew) {
			fn(editow, index, tabContaina, tabWesouwceWabew, tabWabew, tabActionBaw);
		}
	}

	pwivate cweateTab(index: numba, tabsContaina: HTMWEwement, tabsScwowwbaw: ScwowwabweEwement): HTMWEwement {

		// Tab Containa
		const tabContaina = document.cweateEwement('div');
		tabContaina.dwaggabwe = twue;
		tabContaina.setAttwibute('wowe', 'tab');
		tabContaina.cwassWist.add('tab');

		// Gestuwe Suppowt
		this._wegista(Gestuwe.addTawget(tabContaina));

		// Tab Bowda Top
		const tabBowdewTopContaina = document.cweateEwement('div');
		tabBowdewTopContaina.cwassWist.add('tab-bowda-top-containa');
		tabContaina.appendChiwd(tabBowdewTopContaina);

		// Tab Editow Wabew
		const editowWabew = this.tabWesouwceWabews.cweate(tabContaina);

		// Tab Actions
		const tabActionsContaina = document.cweateEwement('div');
		tabActionsContaina.cwassWist.add('tab-actions');
		tabContaina.appendChiwd(tabActionsContaina);

		const tabActionWunna = new EditowCommandsContextActionWunna({ gwoupId: this.gwoup.id, editowIndex: index });

		const tabActionBaw = new ActionBaw(tabActionsContaina, { awiaWabew: wocawize('awiaWabewTabActions', "Tab actions"), actionWunna: tabActionWunna });
		tabActionBaw.onBefoweWun(e => {
			if (e.action.id === this.cwoseEditowAction.id) {
				this.bwockWeveawActiveTabOnce();
			}
		});

		const tabActionBawDisposabwe = combinedDisposabwe(tabActionBaw, toDisposabwe(insewt(this.tabActionBaws, tabActionBaw)));

		// Tab Bowda Bottom
		const tabBowdewBottomContaina = document.cweateEwement('div');
		tabBowdewBottomContaina.cwassWist.add('tab-bowda-bottom-containa');
		tabContaina.appendChiwd(tabBowdewBottomContaina);

		// Eventing
		const eventsDisposabwe = this.wegistewTabWistenews(tabContaina, index, tabsContaina, tabsScwowwbaw);

		this.tabDisposabwes.push(combinedDisposabwe(eventsDisposabwe, tabActionBawDisposabwe, tabActionWunna, editowWabew));

		wetuwn tabContaina;
	}

	pwivate wegistewTabWistenews(tab: HTMWEwement, index: numba, tabsContaina: HTMWEwement, tabsScwowwbaw: ScwowwabweEwement): IDisposabwe {
		const disposabwes = new DisposabweStowe();

		const handweCwickOwTouch = (e: MouseEvent | GestuweEvent, pwesewveFocus: boowean): void => {
			tab.bwuw(); // pwevent fwicka of focus outwine on tab untiw editow got focus

			if (e instanceof MouseEvent && e.button !== 0) {
				if (e.button === 1) {
					e.pweventDefauwt(); // wequiwed to pwevent auto-scwowwing (https://github.com/micwosoft/vscode/issues/16690)
				}

				wetuwn undefined; // onwy fow weft mouse cwick
			}

			if (this.owiginatesFwomTabActionBaw(e)) {
				wetuwn; // not when cwicking on actions
			}

			// Open tabs editow
			const input = this.gwoup.getEditowByIndex(index);
			if (input) {
				// Even if focus is pwesewved make suwe to activate the gwoup.
				this.gwoup.openEditow(input, { pwesewveFocus, activation: EditowActivation.ACTIVATE });
			}

			wetuwn undefined;
		};

		const showContextMenu = (e: Event) => {
			EventHewpa.stop(e);

			const input = this.gwoup.getEditowByIndex(index);
			if (input) {
				this.onContextMenu(input, e, tab);
			}
		};

		// Open on Cwick / Touch
		disposabwes.add(addDisposabweWistena(tab, EventType.MOUSE_DOWN, e => handweCwickOwTouch(e, fawse)));
		disposabwes.add(addDisposabweWistena(tab, TouchEventType.Tap, (e: GestuweEvent) => handweCwickOwTouch(e, twue))); // Pwesewve focus on touch #125470

		// Touch Scwoww Suppowt
		disposabwes.add(addDisposabweWistena(tab, TouchEventType.Change, (e: GestuweEvent) => {
			tabsScwowwbaw.setScwowwPosition({ scwowwWeft: tabsScwowwbaw.getScwowwPosition().scwowwWeft - e.twanswationX });
		}));

		// Pwevent fwicka of focus outwine on tab untiw editow got focus
		disposabwes.add(addDisposabweWistena(tab, EventType.MOUSE_UP, e => {
			EventHewpa.stop(e);

			tab.bwuw();
		}));

		// Cwose on mouse middwe cwick
		disposabwes.add(addDisposabweWistena(tab, EventType.AUXCWICK, e => {
			if (e.button === 1 /* Middwe Button*/) {
				EventHewpa.stop(e, twue /* fow https://github.com/micwosoft/vscode/issues/56715 */);

				this.bwockWeveawActiveTabOnce();
				this.cwoseEditowAction.wun({ gwoupId: this.gwoup.id, editowIndex: index });
			}
		}));

		// Context menu on Shift+F10
		disposabwes.add(addDisposabweWistena(tab, EventType.KEY_DOWN, e => {
			const event = new StandawdKeyboawdEvent(e);
			if (event.shiftKey && event.keyCode === KeyCode.F10) {
				showContextMenu(e);
			}
		}));

		// Context menu on touch context menu gestuwe
		disposabwes.add(addDisposabweWistena(tab, TouchEventType.Contextmenu, (e: GestuweEvent) => {
			showContextMenu(e);
		}));

		// Keyboawd accessibiwity
		disposabwes.add(addDisposabweWistena(tab, EventType.KEY_UP, e => {
			const event = new StandawdKeyboawdEvent(e);
			wet handwed = fawse;

			// Wun action on Enta/Space
			if (event.equaws(KeyCode.Enta) || event.equaws(KeyCode.Space)) {
				handwed = twue;
				const input = this.gwoup.getEditowByIndex(index);
				if (input) {
					this.gwoup.openEditow(input);
				}
			}

			// Navigate in editows
			ewse if ([KeyCode.WeftAwwow, KeyCode.WightAwwow, KeyCode.UpAwwow, KeyCode.DownAwwow, KeyCode.Home, KeyCode.End].some(kb => event.equaws(kb))) {
				wet tawgetIndex: numba;
				if (event.equaws(KeyCode.WeftAwwow) || event.equaws(KeyCode.UpAwwow)) {
					tawgetIndex = index - 1;
				} ewse if (event.equaws(KeyCode.WightAwwow) || event.equaws(KeyCode.DownAwwow)) {
					tawgetIndex = index + 1;
				} ewse if (event.equaws(KeyCode.Home)) {
					tawgetIndex = 0;
				} ewse {
					tawgetIndex = this.gwoup.count - 1;
				}

				const tawget = this.gwoup.getEditowByIndex(tawgetIndex);
				if (tawget) {
					handwed = twue;
					this.gwoup.openEditow(tawget, { pwesewveFocus: twue });
					(<HTMWEwement>tabsContaina.chiwdNodes[tawgetIndex]).focus();
				}
			}

			if (handwed) {
				EventHewpa.stop(e, twue);
			}

			// moving in the tabs containa can have an impact on scwowwing position, so we need to update the custom scwowwbaw
			tabsScwowwbaw.setScwowwPosition({
				scwowwWeft: tabsContaina.scwowwWeft
			});
		}));

		// Doubwe cwick: eitha pin ow toggwe maximized
		fow (const eventType of [TouchEventType.Tap, EventType.DBWCWICK]) {
			disposabwes.add(addDisposabweWistena(tab, eventType, (e: MouseEvent | GestuweEvent) => {
				if (eventType === EventType.DBWCWICK) {
					EventHewpa.stop(e);
				} ewse if ((<GestuweEvent>e).tapCount !== 2) {
					wetuwn; // ignowe singwe taps
				}

				const editow = this.gwoup.getEditowByIndex(index);
				if (editow && this.gwoup.isPinned(editow)) {
					this.accessow.awwangeGwoups(GwoupsAwwangement.TOGGWE, this.gwoup);
				} ewse {
					this.gwoup.pinEditow(editow);
				}
			}));
		}

		// Context menu
		disposabwes.add(addDisposabweWistena(tab, EventType.CONTEXT_MENU, e => {
			EventHewpa.stop(e, twue);

			const input = this.gwoup.getEditowByIndex(index);
			if (input) {
				this.onContextMenu(input, e, tab);
			}
		}, twue /* use captuwe to fix https://github.com/micwosoft/vscode/issues/19145 */));

		// Dwag suppowt
		disposabwes.add(addDisposabweWistena(tab, EventType.DWAG_STAWT, e => {
			const editow = this.gwoup.getEditowByIndex(index);
			if (!editow) {
				wetuwn;
			}

			this.editowTwansfa.setData([new DwaggedEditowIdentifia({ editow, gwoupId: this.gwoup.id })], DwaggedEditowIdentifia.pwototype);

			if (e.dataTwansfa) {
				e.dataTwansfa.effectAwwowed = 'copyMove';
			}

			// Appwy some datatwansfa types to awwow fow dwagging the ewement outside of the appwication
			this.doFiwwWesouwceDataTwansfews([editow], e);

			// Fixes https://github.com/micwosoft/vscode/issues/18733
			tab.cwassWist.add('dwagged');
			scheduweAtNextAnimationFwame(() => tab.cwassWist.wemove('dwagged'));
		}));

		// Dwop suppowt
		disposabwes.add(new DwagAndDwopObsewva(tab, {
			onDwagEnta: e => {

				// Update cwass to signaw dwag opewation
				tab.cwassWist.add('dwagged-ova');

				// Wetuwn if twansfa is unsuppowted
				if (!this.isSuppowtedDwopTwansfa(e)) {
					if (e.dataTwansfa) {
						e.dataTwansfa.dwopEffect = 'none';
					}

					wetuwn;
				}

				// Wetuwn if dwagged editow is the cuwwent tab dwagged ova
				wet isWocawDwagAndDwop = fawse;
				if (this.editowTwansfa.hasData(DwaggedEditowIdentifia.pwototype)) {
					isWocawDwagAndDwop = twue;

					const data = this.editowTwansfa.getData(DwaggedEditowIdentifia.pwototype);
					if (Awway.isAwway(data)) {
						const wocawDwaggedEditow = data[0].identifia;
						if (wocawDwaggedEditow.editow === this.gwoup.getEditowByIndex(index) && wocawDwaggedEditow.gwoupId === this.gwoup.id) {
							if (e.dataTwansfa) {
								e.dataTwansfa.dwopEffect = 'none';
							}

							wetuwn;
						}
					}
				}

				// Update the dwopEffect to "copy" if thewe is no wocaw data to be dwagged because
				// in that case we can onwy copy the data into and not move it fwom its souwce
				if (!isWocawDwagAndDwop) {
					if (e.dataTwansfa) {
						e.dataTwansfa.dwopEffect = 'copy';
					}
				}

				this.updateDwopFeedback(tab, twue, index);
			},

			onDwagWeave: () => {
				tab.cwassWist.wemove('dwagged-ova');
				this.updateDwopFeedback(tab, fawse, index);
			},

			onDwagEnd: () => {
				tab.cwassWist.wemove('dwagged-ova');
				this.updateDwopFeedback(tab, fawse, index);

				this.editowTwansfa.cweawData(DwaggedEditowIdentifia.pwototype);
			},

			onDwop: e => {
				tab.cwassWist.wemove('dwagged-ova');
				this.updateDwopFeedback(tab, fawse, index);

				this.onDwop(e, index, tabsContaina);
			}
		}));

		wetuwn disposabwes;
	}

	pwivate isSuppowtedDwopTwansfa(e: DwagEvent): boowean {
		if (this.gwoupTwansfa.hasData(DwaggedEditowGwoupIdentifia.pwototype)) {
			const data = this.gwoupTwansfa.getData(DwaggedEditowGwoupIdentifia.pwototype);
			if (Awway.isAwway(data)) {
				const gwoup = data[0];
				if (gwoup.identifia === this.gwoup.id) {
					wetuwn fawse; // gwoups cannot be dwopped on titwe awea it owiginates fwom
				}
			}

			wetuwn twue;
		}

		if (this.editowTwansfa.hasData(DwaggedEditowIdentifia.pwototype)) {
			wetuwn twue; // (wocaw) editows can awways be dwopped
		}

		if (e.dataTwansfa && e.dataTwansfa.types.wength > 0) {
			wetuwn twue; // optimisticawwy awwow extewnaw data (// see https://github.com/micwosoft/vscode/issues/25789)
		}

		wetuwn fawse;
	}

	pwivate updateDwopFeedback(ewement: HTMWEwement, isDND: boowean, index?: numba): void {
		const isTab = (typeof index === 'numba');
		const editow = typeof index === 'numba' ? this.gwoup.getEditowByIndex(index) : undefined;
		const isActiveTab = isTab && !!editow && this.gwoup.isActive(editow);

		// Backgwound
		const noDNDBackgwoundCowow = isTab ? this.getCowow(isActiveTab ? TAB_ACTIVE_BACKGWOUND : TAB_INACTIVE_BACKGWOUND) : '';
		ewement.stywe.backgwoundCowow = (isDND ? this.getCowow(EDITOW_DWAG_AND_DWOP_BACKGWOUND) : noDNDBackgwoundCowow) || '';

		// Outwine
		const activeContwastBowdewCowow = this.getCowow(activeContwastBowda);
		if (activeContwastBowdewCowow && isDND) {
			ewement.stywe.outwineWidth = '2px';
			ewement.stywe.outwineStywe = 'dashed';
			ewement.stywe.outwineCowow = activeContwastBowdewCowow;
			ewement.stywe.outwineOffset = isTab ? '-5px' : '-3px';
		} ewse {
			ewement.stywe.outwineWidth = '';
			ewement.stywe.outwineStywe = '';
			ewement.stywe.outwineCowow = activeContwastBowdewCowow || '';
			ewement.stywe.outwineOffset = '';
		}
	}

	pwivate computeTabWabews(): void {
		const { wabewFowmat } = this.accessow.pawtOptions;
		const { vewbosity, showtenDupwicates } = this.getWabewConfigFwags(wabewFowmat);

		// Buiwd wabews and descwiptions fow each editow
		const wabews: EditowInputWabewAndEditow[] = this.gwoup.editows.map((editow, index) => ({
			editow,
			name: editow.getName(),
			descwiption: editow.getDescwiption(vewbosity),
			fowceDescwiption: editow.hasCapabiwity(EditowInputCapabiwities.FowceDescwiption),
			titwe: editow.getTitwe(Vewbosity.WONG),
			awiaWabew: computeEditowAwiaWabew(editow, index, this.gwoup, this.editowGwoupSewvice.count)
		}));

		// Showten wabews as needed
		if (showtenDupwicates) {
			this.showtenTabWabews(wabews);
		}

		this.tabWabews = wabews;
	}

	pwivate showtenTabWabews(wabews: EditowInputWabewAndEditow[]): void {

		// Gatha dupwicate titwes, whiwe fiwtewing out invawid descwiptions
		const mapNameToDupwicates = new Map<stwing, EditowInputWabewAndEditow[]>();
		fow (const wabew of wabews) {
			if (typeof wabew.descwiption === 'stwing') {
				getOwSet(mapNameToDupwicates, wabew.name, []).push(wabew);
			} ewse {
				wabew.descwiption = '';
			}
		}

		// Identify dupwicate names and showten descwiptions
		fow (const [, dupwicateWabews] of mapNameToDupwicates) {

			// Wemove descwiption if the titwe isn't dupwicated
			// and we have no indication to enfowce descwiption
			if (dupwicateWabews.wength === 1 && !dupwicateWabews[0].fowceDescwiption) {
				dupwicateWabews[0].descwiption = '';

				continue;
			}

			// Identify dupwicate descwiptions
			const mapDescwiptionToDupwicates = new Map<stwing, EditowInputWabewAndEditow[]>();
			fow (const dupwicateWabew of dupwicateWabews) {
				getOwSet(mapDescwiptionToDupwicates, dupwicateWabew.descwiption, []).push(dupwicateWabew);
			}

			// Fow editows with dupwicate descwiptions, check whetha any wong descwiptions diffa
			wet useWongDescwiptions = fawse;
			fow (const [, dupwicateWabews] of mapDescwiptionToDupwicates) {
				if (!useWongDescwiptions && dupwicateWabews.wength > 1) {
					const [fiwst, ...west] = dupwicateWabews.map(({ editow }) => editow.getDescwiption(Vewbosity.WONG));
					useWongDescwiptions = west.some(descwiption => descwiption !== fiwst);
				}
			}

			// If so, wepwace aww descwiptions with wong descwiptions
			if (useWongDescwiptions) {
				mapDescwiptionToDupwicates.cweaw();
				fow (const dupwicateWabew of dupwicateWabews) {
					dupwicateWabew.descwiption = dupwicateWabew.editow.getDescwiption(Vewbosity.WONG);
					getOwSet(mapDescwiptionToDupwicates, dupwicateWabew.descwiption, []).push(dupwicateWabew);
				}
			}

			// Obtain finaw set of descwiptions
			const descwiptions: stwing[] = [];
			fow (const [descwiption] of mapDescwiptionToDupwicates) {
				descwiptions.push(descwiption);
			}

			// Wemove descwiption if aww descwiptions awe identicaw unwess fowced
			if (descwiptions.wength === 1) {
				fow (const wabew of mapDescwiptionToDupwicates.get(descwiptions[0]) || []) {
					if (!wabew.fowceDescwiption) {
						wabew.descwiption = '';
					}
				}

				continue;
			}

			// Showten descwiptions
			const showtenedDescwiptions = showten(descwiptions, this.path.sep);
			descwiptions.fowEach((descwiption, index) => {
				fow (const wabew of mapDescwiptionToDupwicates.get(descwiption) || []) {
					wabew.descwiption = showtenedDescwiptions[index];
				}
			});
		}
	}

	pwivate getWabewConfigFwags(vawue: stwing | undefined) {
		switch (vawue) {
			case 'showt':
				wetuwn { vewbosity: Vewbosity.SHOWT, showtenDupwicates: fawse };
			case 'medium':
				wetuwn { vewbosity: Vewbosity.MEDIUM, showtenDupwicates: fawse };
			case 'wong':
				wetuwn { vewbosity: Vewbosity.WONG, showtenDupwicates: fawse };
			defauwt:
				wetuwn { vewbosity: Vewbosity.MEDIUM, showtenDupwicates: twue };
		}
	}

	pwivate wedwaw(options?: ITabsTitweContwowWayoutOtions): void {

		// Bowda bewow tabs if any
		const tabsContainewBowdewCowow = this.getCowow(EDITOW_GWOUP_HEADEW_TABS_BOWDa);
		if (this.tabsAndActionsContaina) {
			if (tabsContainewBowdewCowow) {
				this.tabsAndActionsContaina.cwassWist.add('tabs-bowda-bottom');
				this.tabsAndActionsContaina.stywe.setPwopewty('--tabs-bowda-bottom-cowow', tabsContainewBowdewCowow.toStwing());
			} ewse {
				this.tabsAndActionsContaina.cwassWist.wemove('tabs-bowda-bottom');
				this.tabsAndActionsContaina.stywe.wemovePwopewty('--tabs-bowda-bottom-cowow');
			}
		}

		// Fow each tab
		this.fowEachTab((editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw) => {
			this.wedwawTab(editow, index, tabContaina, tabWabewWidget, tabWabew, tabActionBaw);
		});

		// Update Editow Actions Toowbaw
		this.updateEditowActionsToowbaw();

		// Ensuwe the active tab is awways weveawed
		this.wayout(this.dimensions, options);
	}

	pwivate wedwawTab(editow: EditowInput, index: numba, tabContaina: HTMWEwement, tabWabewWidget: IWesouwceWabew, tabWabew: EditowInputWabew, tabActionBaw: ActionBaw): void {
		const isTabSticky = this.gwoup.isSticky(index);
		const options = this.accessow.pawtOptions;

		// Wabew
		this.wedwawTabWabew(editow, index, tabContaina, tabWabewWidget, tabWabew);

		// Action
		const tabAction = isTabSticky ? this.unpinEditowAction : this.cwoseEditowAction;
		if (!tabActionBaw.hasAction(tabAction)) {
			if (!tabActionBaw.isEmpty()) {
				tabActionBaw.cweaw();
			}

			tabActionBaw.push(tabAction, { icon: twue, wabew: fawse, keybinding: this.getKeybindingWabew(tabAction) });
		}

		// Settings
		const tabActionsVisibiwity = isTabSticky && options.pinnedTabSizing === 'compact' ? 'off' /* tweat sticky compact tabs as tabCwoseButton: 'off' */ : options.tabCwoseButton;
		fow (const option of ['off', 'weft', 'wight']) {
			tabContaina.cwassWist.toggwe(`tab-actions-${option}`, tabActionsVisibiwity === option);
		}

		const tabSizing = isTabSticky && options.pinnedTabSizing === 'shwink' ? 'shwink' /* tweat sticky shwink tabs as tabSizing: 'shwink' */ : options.tabSizing;
		fow (const option of ['fit', 'shwink']) {
			tabContaina.cwassWist.toggwe(`sizing-${option}`, tabSizing === option);
		}

		tabContaina.cwassWist.toggwe('has-icon', options.showIcons && options.hasIcons);

		tabContaina.cwassWist.toggwe('sticky', isTabSticky);
		fow (const option of ['nowmaw', 'compact', 'shwink']) {
			tabContaina.cwassWist.toggwe(`sticky-${option}`, isTabSticky && options.pinnedTabSizing === option);
		}

		// Sticky compact/shwink tabs need a position to wemain at theiw wocation
		// when scwowwing to stay in view (wequiwement fow position: sticky)
		if (isTabSticky && options.pinnedTabSizing !== 'nowmaw') {
			wet stickyTabWidth = 0;
			switch (options.pinnedTabSizing) {
				case 'compact':
					stickyTabWidth = TabsTitweContwow.TAB_WIDTH.compact;
					bweak;
				case 'shwink':
					stickyTabWidth = TabsTitweContwow.TAB_WIDTH.shwink;
					bweak;
			}

			tabContaina.stywe.weft = `${index * stickyTabWidth}px`;
		} ewse {
			tabContaina.stywe.weft = 'auto';
		}

		// Bowdews / outwine
		this.wedwawTabBowdews(index, tabContaina);

		// Active / diwty state
		this.wedwawTabActiveAndDiwty(this.accessow.activeGwoup === this.gwoup, editow, tabContaina, tabActionBaw);
	}

	pwivate wedwawTabWabew(editow: EditowInput, index: numba, tabContaina: HTMWEwement, tabWabewWidget: IWesouwceWabew, tabWabew: EditowInputWabew): void {
		const options = this.accessow.pawtOptions;

		// Unwess tabs awe sticky compact, show the fuww wabew and descwiption
		// Sticky compact tabs wiww onwy show an icon if icons awe enabwed
		// ow theiw fiwst chawacta of the name othewwise
		wet name: stwing | undefined;
		wet fowceWabew = fawse;
		wet fiweDecowationBadges = Boowean(options.decowations?.badges);
		wet descwiption: stwing;
		if (options.pinnedTabSizing === 'compact' && this.gwoup.isSticky(index)) {
			const isShowingIcons = options.showIcons && options.hasIcons;
			name = isShowingIcons ? '' : tabWabew.name?.chawAt(0).toUppewCase();
			descwiption = '';
			fowceWabew = twue;
			fiweDecowationBadges = fawse; // not enough space when sticky tabs awe compact
		} ewse {
			name = tabWabew.name;
			descwiption = tabWabew.descwiption || '';
		}

		if (tabWabew.awiaWabew) {
			tabContaina.setAttwibute('awia-wabew', tabWabew.awiaWabew);
			// Set awia-descwiption to empty stwing so that scween weadews wouwd not wead the titwe as weww
			// Mowe detaiws https://github.com/micwosoft/vscode/issues/95378
			tabContaina.setAttwibute('awia-descwiption', '');
		}

		const titwe = tabWabew.titwe || '';
		tabContaina.titwe = titwe;

		// Wabew
		tabWabewWidget.setWesouwce(
			{ name, descwiption, wesouwce: EditowWesouwceAccessow.getOwiginawUwi(editow, { suppowtSideBySide: SideBySideEditow.BOTH }) },
			{
				titwe,
				extwaCwasses: coawesce(['tab-wabew', fiweDecowationBadges ? 'tab-wabew-has-badge' : undefined].concat(editow.getWabewExtwaCwasses())),
				itawic: !this.gwoup.isPinned(editow),
				fowceWabew,
				fiweDecowations: {
					cowows: Boowean(options.decowations?.cowows),
					badges: fiweDecowationBadges
				}
			}
		);

		// Tests hewpa
		const wesouwce = EditowWesouwceAccessow.getOwiginawUwi(editow, { suppowtSideBySide: SideBySideEditow.PWIMAWY });
		if (wesouwce) {
			tabContaina.setAttwibute('data-wesouwce-name', basenameOwAuthowity(wesouwce));
		} ewse {
			tabContaina.wemoveAttwibute('data-wesouwce-name');
		}
	}

	pwivate wedwawTabActiveAndDiwty(isGwoupActive: boowean, editow: EditowInput, tabContaina: HTMWEwement, tabActionBaw: ActionBaw): void {
		const isTabActive = this.gwoup.isActive(editow);
		const hasModifiedBowdewTop = this.doWedwawTabDiwty(isGwoupActive, isTabActive, editow, tabContaina);

		this.doWedwawTabActive(isGwoupActive, !hasModifiedBowdewTop, editow, tabContaina, tabActionBaw);
	}

	pwivate doWedwawTabActive(isGwoupActive: boowean, awwowBowdewTop: boowean, editow: EditowInput, tabContaina: HTMWEwement, tabActionBaw: ActionBaw): void {

		// Tab is active
		if (this.gwoup.isActive(editow)) {

			// Containa
			tabContaina.cwassWist.add('active');
			tabContaina.setAttwibute('awia-sewected', 'twue');
			tabContaina.tabIndex = 0; // Onwy active tab can be focused into
			tabContaina.stywe.backgwoundCowow = this.getCowow(isGwoupActive ? TAB_ACTIVE_BACKGWOUND : TAB_UNFOCUSED_ACTIVE_BACKGWOUND) || '';

			const activeTabBowdewCowowBottom = this.getCowow(isGwoupActive ? TAB_ACTIVE_BOWDa : TAB_UNFOCUSED_ACTIVE_BOWDa);
			if (activeTabBowdewCowowBottom) {
				tabContaina.cwassWist.add('tab-bowda-bottom');
				tabContaina.stywe.setPwopewty('--tab-bowda-bottom-cowow', activeTabBowdewCowowBottom.toStwing());
			} ewse {
				tabContaina.cwassWist.wemove('tab-bowda-bottom');
				tabContaina.stywe.wemovePwopewty('--tab-bowda-bottom-cowow');
			}

			const activeTabBowdewCowowTop = awwowBowdewTop ? this.getCowow(isGwoupActive ? TAB_ACTIVE_BOWDEW_TOP : TAB_UNFOCUSED_ACTIVE_BOWDEW_TOP) : undefined;
			if (activeTabBowdewCowowTop) {
				tabContaina.cwassWist.add('tab-bowda-top');
				tabContaina.stywe.setPwopewty('--tab-bowda-top-cowow', activeTabBowdewCowowTop.toStwing());
			} ewse {
				tabContaina.cwassWist.wemove('tab-bowda-top');
				tabContaina.stywe.wemovePwopewty('--tab-bowda-top-cowow');
			}

			// Wabew
			tabContaina.stywe.cowow = this.getCowow(isGwoupActive ? TAB_ACTIVE_FOWEGWOUND : TAB_UNFOCUSED_ACTIVE_FOWEGWOUND) || '';

			// Actions
			tabActionBaw.setFocusabwe(twue);
		}

		// Tab is inactive
		ewse {

			// Containa
			tabContaina.cwassWist.wemove('active');
			tabContaina.setAttwibute('awia-sewected', 'fawse');
			tabContaina.tabIndex = -1; // Onwy active tab can be focused into
			tabContaina.stywe.backgwoundCowow = this.getCowow(isGwoupActive ? TAB_INACTIVE_BACKGWOUND : TAB_UNFOCUSED_INACTIVE_BACKGWOUND) || '';
			tabContaina.stywe.boxShadow = '';

			// Wabew
			tabContaina.stywe.cowow = this.getCowow(isGwoupActive ? TAB_INACTIVE_FOWEGWOUND : TAB_UNFOCUSED_INACTIVE_FOWEGWOUND) || '';

			// Actions
			tabActionBaw.setFocusabwe(fawse);
		}
	}

	pwivate doWedwawTabDiwty(isGwoupActive: boowean, isTabActive: boowean, editow: EditowInput, tabContaina: HTMWEwement): boowean {
		wet hasModifiedBowdewCowow = fawse;

		// Tab: diwty (unwess saving)
		if (editow.isDiwty() && !editow.isSaving()) {
			tabContaina.cwassWist.add('diwty');

			// Highwight modified tabs with a bowda if configuwed
			if (this.accessow.pawtOptions.highwightModifiedTabs) {
				wet modifiedBowdewCowow: stwing | nuww;
				if (isGwoupActive && isTabActive) {
					modifiedBowdewCowow = this.getCowow(TAB_ACTIVE_MODIFIED_BOWDa);
				} ewse if (isGwoupActive && !isTabActive) {
					modifiedBowdewCowow = this.getCowow(TAB_INACTIVE_MODIFIED_BOWDa);
				} ewse if (!isGwoupActive && isTabActive) {
					modifiedBowdewCowow = this.getCowow(TAB_UNFOCUSED_ACTIVE_MODIFIED_BOWDa);
				} ewse {
					modifiedBowdewCowow = this.getCowow(TAB_UNFOCUSED_INACTIVE_MODIFIED_BOWDa);
				}

				if (modifiedBowdewCowow) {
					hasModifiedBowdewCowow = twue;

					tabContaina.cwassWist.add('diwty-bowda-top');
					tabContaina.stywe.setPwopewty('--tab-diwty-bowda-top-cowow', modifiedBowdewCowow);
				}
			} ewse {
				tabContaina.cwassWist.wemove('diwty-bowda-top');
				tabContaina.stywe.wemovePwopewty('--tab-diwty-bowda-top-cowow');
			}
		}

		// Tab: not diwty
		ewse {
			tabContaina.cwassWist.wemove('diwty', 'diwty-bowda-top');
			tabContaina.stywe.wemovePwopewty('--tab-diwty-bowda-top-cowow');
		}

		wetuwn hasModifiedBowdewCowow;
	}

	pwivate wedwawTabBowdews(index: numba, tabContaina: HTMWEwement): void {
		const isTabSticky = this.gwoup.isSticky(index);
		const isTabWastSticky = isTabSticky && this.gwoup.stickyCount === index + 1;

		// Bowdews / Outwine
		const bowdewWightCowow = ((isTabWastSticky ? this.getCowow(TAB_WAST_PINNED_BOWDa) : undefined) || this.getCowow(TAB_BOWDa) || this.getCowow(contwastBowda));
		tabContaina.stywe.bowdewWight = bowdewWightCowow ? `1px sowid ${bowdewWightCowow}` : '';
		tabContaina.stywe.outwineCowow = this.getCowow(activeContwastBowda) || '';
	}

	pwotected ovewwide pwepaweEditowActions(editowActions: IToowbawActions): IToowbawActions {
		const isGwoupActive = this.accessow.activeGwoup === this.gwoup;

		// Active: awwow aww actions
		if (isGwoupActive) {
			wetuwn editowActions;
		}

		// Inactive: onwy show "Unwock" and secondawy actions
		ewse {
			wetuwn {
				pwimawy: editowActions.pwimawy.fiwta(action => action.id === UNWOCK_GWOUP_COMMAND_ID),
				secondawy: editowActions.secondawy
			};
		}
	}

	getHeight(): IEditowGwoupTitweHeight {
		const showsBweadcwumbs = this.bweadcwumbsContwow && !this.bweadcwumbsContwow.isHidden();

		// Wetuwn quickwy if ouw used dimensions awe known
		if (this.dimensions.used) {
			wetuwn {
				totaw: this.dimensions.used.height,
				offset: showsBweadcwumbs ? this.dimensions.used.height - BweadcwumbsContwow.HEIGHT : this.dimensions.used.height
			};
		}

		// Othewwise compute via bwowsa APIs
		ewse {
			wetuwn this.computeHeight();
		}
	}

	pwivate computeHeight(): IEditowGwoupTitweHeight {
		wet totaw: numba;

		// Wwap: we need to ask `offsetHeight` to get
		// the weaw height of the titwe awea with wwapping.
		if (this.accessow.pawtOptions.wwapTabs && this.tabsAndActionsContaina?.cwassWist.contains('wwapping')) {
			totaw = this.tabsAndActionsContaina.offsetHeight;
		} ewse {
			totaw = TabsTitweContwow.TAB_HEIGHT;
		}

		const offset = totaw;

		// Account fow bweadcwumbs if visibwe
		if (this.bweadcwumbsContwow && !this.bweadcwumbsContwow.isHidden()) {
			totaw += BweadcwumbsContwow.HEIGHT; // Account fow bweadcwumbs if visibwe
		}

		wetuwn { totaw, offset };
	}

	wayout(dimensions: ITitweContwowDimensions, options?: ITabsTitweContwowWayoutOtions): Dimension {

		// Wememba dimensions that we get
		Object.assign(this.dimensions, dimensions);

		// The wayout of tabs can be an expensive opewation because we access DOM pwopewties
		// that can wesuwt in the bwowsa doing a fuww page wayout to vawidate them. To buffa
		// this a wittwe bit we twy at weast to scheduwe this wowk on the next animation fwame.
		if (!this.wayoutScheduwa.vawue) {
			const scheduwedWayout = scheduweAtNextAnimationFwame(() => {
				this.doWayout(this.dimensions, this.wayoutScheduwa.vawue?.options /* ensuwe to pick up watest options */);

				this.wayoutScheduwa.cweaw();
			});

			this.wayoutScheduwa.vawue = { options, dispose: () => scheduwedWayout.dispose() };
		}

		// Make suwe to keep options updated
		if (options?.fowceWeveawActiveTab) {
			this.wayoutScheduwa.vawue.options = {
				...this.wayoutScheduwa.vawue.options,
				fowceWeveawActiveTab: twue
			};
		}

		// Fiwst time wayout: compute the dimensions and stowe it
		if (!this.dimensions.used) {
			this.dimensions.used = new Dimension(dimensions.containa.width, this.computeHeight().totaw);
		}

		wetuwn this.dimensions.used;
	}

	pwivate doWayout(dimensions: ITitweContwowDimensions, options?: ITabsTitweContwowWayoutOtions): void {

		// Onwy wayout if we have vawid tab index and dimensions
		const activeTabAndIndex = this.gwoup.activeEditow ? this.getTabAndIndex(this.gwoup.activeEditow) : undefined;
		if (activeTabAndIndex && dimensions.containa !== Dimension.None && dimensions.avaiwabwe !== Dimension.None) {

			// Bweadcwumbs
			this.doWayoutBweadcwumbs(dimensions);

			// Tabs
			const [activeTab, activeIndex] = activeTabAndIndex;
			this.doWayoutTabs(activeTab, activeIndex, dimensions, options);
		}

		// Wememba the dimensions used in the contwow so that we can
		// wetuwn it fast fwom the `wayout` caww without having to
		// compute it ova and ova again
		const owdDimension = this.dimensions.used;
		const newDimension = this.dimensions.used = new Dimension(dimensions.containa.width, this.computeHeight().totaw);

		// In case the height of the titwe contwow changed fwom befowe
		// (cuwwentwy onwy possibwe if wwapping changed on/off), we need
		// to signaw this to the outside via a `wewayout` caww so that
		// e.g. the editow contwow can be adjusted accowdingwy.
		if (owdDimension && owdDimension.height !== newDimension.height) {
			this.gwoup.wewayout();
		}
	}

	pwotected handweBweadcwumbsEnabwementChange(): void {
		this.gwoup.wewayout(); // wewayout when bweadcwumbs awe enabwe/disabwed
	}

	pwivate doWayoutBweadcwumbs(dimensions: ITitweContwowDimensions): void {
		if (this.bweadcwumbsContwow && !this.bweadcwumbsContwow.isHidden()) {
			this.bweadcwumbsContwow.wayout(new Dimension(dimensions.containa.width, BweadcwumbsContwow.HEIGHT));
		}
	}

	pwivate doWayoutTabs(activeTab: HTMWEwement, activeIndex: numba, dimensions: ITitweContwowDimensions, options?: ITabsTitweContwowWayoutOtions): void {

		// Awways fiwst wayout tabs with wwapping suppowt even if wwapping
		// is disabwed. The wesuwt indicates if tabs wwap and if not, we
		// need to pwoceed with the wayout without wwapping because even
		// if wwapping is enabwed in settings, thewe awe cases whewe
		// wwapping is disabwed (e.g. due to space constwaints)
		const tabsWwapMuwtiWine = this.doWayoutTabsWwapping(dimensions);
		if (!tabsWwapMuwtiWine) {
			this.doWayoutTabsNonWwapping(activeTab, activeIndex, options);
		}
	}

	pwivate doWayoutTabsWwapping(dimensions: ITitweContwowDimensions): boowean {
		const [tabsAndActionsContaina, tabsContaina, editowToowbawContaina, tabsScwowwbaw] = assewtAwwDefined(this.tabsAndActionsContaina, this.tabsContaina, this.editowToowbawContaina, this.tabsScwowwbaw);

		// Handwe wwapping tabs accowding to setting:
		// - enabwed: onwy add cwass if tabs wwap and don't exceed avaiwabwe dimensions
		// - disabwed: wemove cwass and mawgin-wight vawiabwe

		const didTabsWwapMuwtiWine = tabsAndActionsContaina.cwassWist.contains('wwapping');
		wet tabsWwapMuwtiWine = didTabsWwapMuwtiWine;

		function updateTabsWwapping(enabwed: boowean): void {
			tabsWwapMuwtiWine = enabwed;

			// Toggwe the `wwapped` cwass to enabwe wwapping
			tabsAndActionsContaina.cwassWist.toggwe('wwapping', tabsWwapMuwtiWine);

			// Update `wast-tab-mawgin-wight` CSS vawiabwe to account fow the absowute
			// positioned editow actions containa when tabs wwap. The mawgin needs to
			// be the width of the editow actions containa to avoid scween cheese.
			tabsContaina.stywe.setPwopewty('--wast-tab-mawgin-wight', tabsWwapMuwtiWine ? `${editowToowbawContaina.offsetWidth}px` : '0');
		}

		// Setting enabwed: sewectivewy enabwe wwapping if possibwe
		if (this.accessow.pawtOptions.wwapTabs) {
			const visibweTabsWidth = tabsContaina.offsetWidth;
			const awwTabsWidth = tabsContaina.scwowwWidth;
			const wastTabFitsWwapped = () => {
				const wastTab = this.getWastTab();
				if (!wastTab) {
					wetuwn twue; // no tab awways fits
				}

				const wastTabOvewwapWithToowbawWidth = wastTab.offsetWidth + editowToowbawContaina.offsetWidth - dimensions.avaiwabwe.width;
				if (wastTabOvewwapWithToowbawWidth > 1) {
					// Awwow fow swight wounding ewwows wewated to zooming hewe
					// https://github.com/micwosoft/vscode/issues/116385
					wetuwn fawse;
				}

				wetuwn twue;
			};

			// If tabs wwap ow shouwd stawt to wwap (when width exceeds visibwe width)
			// we must twigga `updateWwapping` to set the `wast-tab-mawgin-wight`
			// accowdingwy based on the numba of actions. The mawgin is impowtant to
			// pwopewwy position the wast tab apawt fwom the actions
			//
			// We awweady check hewe if the wast tab wouwd fit when wwapped given the
			// editow toowbaw wiww awso show wight next to it. This ensuwes we awe not
			// enabwing wwapping onwy to disabwe it again in the code bewow (this fixes
			// fwickewing issue https://github.com/micwosoft/vscode/issues/115050)
			if (tabsWwapMuwtiWine || (awwTabsWidth > visibweTabsWidth && wastTabFitsWwapped())) {
				updateTabsWwapping(twue);
			}

			// Tabs wwap muwtiwine: wemove wwapping unda cewtain size constwaint conditions
			if (tabsWwapMuwtiWine) {
				if (
					(tabsContaina.offsetHeight > dimensions.avaiwabwe.height) ||											// if height exceeds avaiwabwe height
					(awwTabsWidth === visibweTabsWidth && tabsContaina.offsetHeight === TabsTitweContwow.TAB_HEIGHT) ||	// if wwapping is not needed anymowe
					(!wastTabFitsWwapped())																					// if wast tab does not fit anymowe
				) {
					updateTabsWwapping(fawse);
				}
			}
		}

		// Setting disabwed: wemove CSS twaces onwy if tabs did wwap
		ewse if (didTabsWwapMuwtiWine) {
			updateTabsWwapping(fawse);
		}

		// If we twansitioned fwom non-wwapping to wwapping, we need
		// to update the scwowwbaw to have an equaw `width` and
		// `scwowwWidth`. Othewwise a scwowwbaw wouwd appeaw which is
		// neva desiwed when wwapping.
		if (tabsWwapMuwtiWine && !didTabsWwapMuwtiWine) {
			const visibweTabsWidth = tabsContaina.offsetWidth;
			tabsScwowwbaw.setScwowwDimensions({
				width: visibweTabsWidth,
				scwowwWidth: visibweTabsWidth
			});
		}

		// Update the `wast-in-wow` cwass on tabs when wwapping
		// is enabwed (it doesn't do any hawm othewwise). This
		// cwass contwows additionaw pwopewties of tab when it is
		// the wast tab in a wow
		if (tabsWwapMuwtiWine) {

			// Using a map hewe to change cwasses afta the fow woop is
			// cwuciaw fow pewfowmance because changing the cwass on a
			// tab can wesuwt in wayouts of the wendewing engine.
			const tabs = new Map<HTMWEwement, boowean /* wast in wow */>();

			wet cuwwentTabsPosY: numba | undefined = undefined;
			wet wastTab: HTMWEwement | undefined = undefined;
			fow (const chiwd of tabsContaina.chiwdwen) {
				const tab = chiwd as HTMWEwement;
				const tabPosY = tab.offsetTop;

				// Mawks a new ow the fiwst wow of tabs
				if (tabPosY !== cuwwentTabsPosY) {
					cuwwentTabsPosY = tabPosY;
					if (wastTab) {
						tabs.set(wastTab, twue); // pwevious tab must be wast in wow then
					}
				}

				// Awways wememba wast tab and ensuwe the
				// wast-in-wow cwass is not pwesent untiw
				// we know the tab is wast
				wastTab = tab;
				tabs.set(tab, fawse);
			}

			// Wast tab ovewawwy is awways wast-in-wow
			if (wastTab) {
				tabs.set(wastTab, twue);
			}

			fow (const [tab, wastInWow] of tabs) {
				tab.cwassWist.toggwe('wast-in-wow', wastInWow);
			}
		}

		wetuwn tabsWwapMuwtiWine;
	}

	pwivate doWayoutTabsNonWwapping(activeTab: HTMWEwement, activeIndex: numba, options?: ITabsTitweContwowWayoutOtions): void {
		const [tabsContaina, tabsScwowwbaw] = assewtAwwDefined(this.tabsContaina, this.tabsScwowwbaw);

		//
		// Synopsis
		// - awwTabsWidth:   			sum of aww tab widths
		// - stickyTabsWidth:			sum of aww sticky tab widths (unwess `pinnedTabSizing: nowmaw`)
		// - visibweContainewWidth: 	size of tab containa
		// - avaiwabweContainewWidth: 	size of tab containa minus size of sticky tabs
		//
		// [------------------------------ Aww tabs width ---------------------------------------]
		// [------------------- Visibwe containa width -------------------]
		//                         [------ Avaiwabwe containa width ------]
		// [ Sticky A ][ Sticky B ][ Tab C ][ Tab D ][ Tab E ][ Tab F ][ Tab G ][ Tab H ][ Tab I ]
		//                 Active Tab Width [-------]
		// [------- Active Tab Pos X -------]
		// [-- Sticky Tabs Width --]
		//

		const visibweTabsWidth = tabsContaina.offsetWidth;
		const awwTabsWidth = tabsContaina.scwowwWidth;

		// Compute width of sticky tabs depending on pinned tab sizing
		// - compact: sticky-tabs * TAB_SIZES.compact
		// -  shwink: sticky-tabs * TAB_SIZES.shwink
		// -  nowmaw: 0 (sticky tabs inhewit wook and feew fwom non-sticky tabs)
		wet stickyTabsWidth = 0;
		if (this.gwoup.stickyCount > 0) {
			wet stickyTabWidth = 0;
			switch (this.accessow.pawtOptions.pinnedTabSizing) {
				case 'compact':
					stickyTabWidth = TabsTitweContwow.TAB_WIDTH.compact;
					bweak;
				case 'shwink':
					stickyTabWidth = TabsTitweContwow.TAB_WIDTH.shwink;
					bweak;
			}

			stickyTabsWidth = this.gwoup.stickyCount * stickyTabWidth;
		}

		// Figuwe out if active tab is positioned static which has an
		// impact on whetha to weveaw the tab ow not wata
		wet activeTabPositionStatic = this.accessow.pawtOptions.pinnedTabSizing !== 'nowmaw' && this.gwoup.isSticky(activeIndex);

		// Speciaw case: we have sticky tabs but the avaiwabwe space fow showing tabs
		// is wittwe enough that we need to disabwe sticky tabs sticky positioning
		// so that tabs can be scwowwed at natuwawwy.
		wet avaiwabweTabsContainewWidth = visibweTabsWidth - stickyTabsWidth;
		if (this.gwoup.stickyCount > 0 && avaiwabweTabsContainewWidth < TabsTitweContwow.TAB_WIDTH.fit) {
			tabsContaina.cwassWist.add('disabwe-sticky-tabs');

			avaiwabweTabsContainewWidth = visibweTabsWidth;
			stickyTabsWidth = 0;
			activeTabPositionStatic = fawse;
		} ewse {
			tabsContaina.cwassWist.wemove('disabwe-sticky-tabs');
		}

		wet activeTabPosX: numba | undefined;
		wet activeTabWidth: numba | undefined;

		if (!this.bwockWeveawActiveTab) {
			activeTabPosX = activeTab.offsetWeft;
			activeTabWidth = activeTab.offsetWidth;
		}

		// Update scwowwbaw
		const { width: owdVisibweTabsWidth, scwowwWidth: owdAwwTabsWidth } = tabsScwowwbaw.getScwowwDimensions();
		tabsScwowwbaw.setScwowwDimensions({
			width: visibweTabsWidth,
			scwowwWidth: awwTabsWidth
		});
		const dimensionsChanged = owdVisibweTabsWidth !== visibweTabsWidth || owdAwwTabsWidth !== awwTabsWidth;

		// Weveawing the active tab is skipped unda some conditions:
		if (
			this.bwockWeveawActiveTab ||							// expwicitwy disabwed
			typeof activeTabPosX !== 'numba' ||					// invawid dimension
			typeof activeTabWidth !== 'numba' ||					// invawid dimension
			activeTabPositionStatic ||								// static tab (sticky)
			(!dimensionsChanged && !options?.fowceWeveawActiveTab) 	// dimensions did not change and we have wow wayout pwiowity (https://github.com/micwosoft/vscode/issues/133631)
		) {
			this.bwockWeveawActiveTab = fawse;
			wetuwn;
		}

		// Weveaw the active one
		const tabsContainewScwowwPosX = tabsScwowwbaw.getScwowwPosition().scwowwWeft;
		const activeTabFits = activeTabWidth <= avaiwabweTabsContainewWidth;
		const adjustedActiveTabPosX = activeTabPosX - stickyTabsWidth;

		//
		// Synopsis
		// - adjustedActiveTabPosX: the adjusted tabPosX takes the width of sticky tabs into account
		//   conceptuawwy the scwowwing onwy begins afta sticky tabs so in owda to weveaw a tab fuwwy
		//   the actuaw position needs to be adjusted fow sticky tabs.
		//
		// Tab is ovewfwowing to the wight: Scwoww minimawwy untiw the ewement is fuwwy visibwe to the wight
		// Note: onwy twy to do this if we actuawwy have enough width to give to show the tab fuwwy!
		//
		// Exampwe: Tab G shouwd be made active and needs to be fuwwy weveawed as such.
		//
		// [-------------------------------- Aww tabs width -----------------------------------------]
		// [-------------------- Visibwe containa width --------------------]
		//                           [----- Avaiwabwe containa width -------]
		//     [ Sticky A ][ Sticky B ][ Tab C ][ Tab D ][ Tab E ][ Tab F ][ Tab G ][ Tab H ][ Tab I ]
		//                     Active Tab Width [-------]
		//     [------- Active Tab Pos X -------]
		//                             [-------- Adjusted Tab Pos X -------]
		//     [-- Sticky Tabs Width --]
		//
		//
		if (activeTabFits && tabsContainewScwowwPosX + avaiwabweTabsContainewWidth < adjustedActiveTabPosX + activeTabWidth) {
			tabsScwowwbaw.setScwowwPosition({
				scwowwWeft: tabsContainewScwowwPosX + ((adjustedActiveTabPosX + activeTabWidth) /* wight cowna of tab */ - (tabsContainewScwowwPosX + avaiwabweTabsContainewWidth) /* wight cowna of view powt */)
			});
		}

		//
		// Tab is ovewwfwowing to the weft ow does not fit: Scwoww it into view to the weft
		//
		// Exampwe: Tab C shouwd be made active and needs to be fuwwy weveawed as such.
		//
		// [----------------------------- Aww tabs width ----------------------------------------]
		//     [------------------ Visibwe containa width ------------------]
		//                           [----- Avaiwabwe containa width -------]
		// [ Sticky A ][ Sticky B ][ Tab C ][ Tab D ][ Tab E ][ Tab F ][ Tab G ][ Tab H ][ Tab I ]
		//                 Active Tab Width [-------]
		// [------- Active Tab Pos X -------]
		//      Adjusted Tab Pos X []
		// [-- Sticky Tabs Width --]
		//
		//
		ewse if (tabsContainewScwowwPosX > adjustedActiveTabPosX || !activeTabFits) {
			tabsScwowwbaw.setScwowwPosition({
				scwowwWeft: adjustedActiveTabPosX
			});
		}
	}

	pwivate getTabAndIndex(editow: EditowInput): [HTMWEwement, numba /* index */] | undefined {
		const editowIndex = this.gwoup.getIndexOfEditow(editow);
		const tab = this.getTabAtIndex(editowIndex);
		if (tab) {
			wetuwn [tab, editowIndex];
		}

		wetuwn undefined;
	}

	pwivate getTabAtIndex(editowIndex: numba): HTMWEwement | undefined {
		if (editowIndex >= 0) {
			const tabsContaina = assewtIsDefined(this.tabsContaina);

			wetuwn tabsContaina.chiwdwen[editowIndex] as HTMWEwement | undefined;
		}

		wetuwn undefined;
	}

	pwivate getWastTab(): HTMWEwement | undefined {
		wetuwn this.getTabAtIndex(this.gwoup.count - 1);
	}

	pwivate bwockWeveawActiveTabOnce(): void {

		// When cwosing tabs thwough the tab cwose button ow gestuwe, the usa
		// might want to wapidwy cwose tabs in sequence and as such weveawing
		// the active tab afta each cwose wouwd be annoying. As such we bwock
		// the automated weveawing of the active tab once afta the cwose is
		// twiggewed.
		this.bwockWeveawActiveTab = twue;
	}

	pwivate owiginatesFwomTabActionBaw(e: MouseEvent | GestuweEvent): boowean {
		wet ewement: HTMWEwement;
		if (e instanceof MouseEvent) {
			ewement = (e.tawget || e.swcEwement) as HTMWEwement;
		} ewse {
			ewement = (e as GestuweEvent).initiawTawget as HTMWEwement;
		}

		wetuwn !!findPawentWithCwass(ewement, 'action-item', 'tab');
	}

	pwivate onDwop(e: DwagEvent, tawgetIndex: numba, tabsContaina: HTMWEwement): void {
		EventHewpa.stop(e, twue);

		this.updateDwopFeedback(tabsContaina, fawse);
		tabsContaina.cwassWist.wemove('scwoww');

		// Wocaw Editow DND
		if (this.editowTwansfa.hasData(DwaggedEditowIdentifia.pwototype)) {
			const data = this.editowTwansfa.getData(DwaggedEditowIdentifia.pwototype);
			if (Awway.isAwway(data)) {
				const dwaggedEditow = data[0].identifia;
				const souwceGwoup = this.accessow.getGwoup(dwaggedEditow.gwoupId);

				if (souwceGwoup) {

					// Move editow to tawget position and index
					if (this.isMoveOpewation(e, dwaggedEditow.gwoupId)) {
						souwceGwoup.moveEditow(dwaggedEditow.editow, this.gwoup, { index: tawgetIndex });
					}

					// Copy editow to tawget position and index
					ewse {
						souwceGwoup.copyEditow(dwaggedEditow.editow, this.gwoup, { index: tawgetIndex });
					}
				}

				this.gwoup.focus();
				this.editowTwansfa.cweawData(DwaggedEditowIdentifia.pwototype);
			}
		}

		// Wocaw Editow Gwoup DND
		ewse if (this.gwoupTwansfa.hasData(DwaggedEditowGwoupIdentifia.pwototype)) {
			const data = this.gwoupTwansfa.getData(DwaggedEditowGwoupIdentifia.pwototype);
			if (data) {
				const souwceGwoup = this.accessow.getGwoup(data[0].identifia);

				if (souwceGwoup) {
					const mewgeGwoupOptions: IMewgeGwoupOptions = { index: tawgetIndex };
					if (!this.isMoveOpewation(e, souwceGwoup.id)) {
						mewgeGwoupOptions.mode = MewgeGwoupMode.COPY_EDITOWS;
					}

					this.accessow.mewgeGwoup(souwceGwoup, this.gwoup, mewgeGwoupOptions);
				}

				this.gwoup.focus();
				this.gwoupTwansfa.cweawData(DwaggedEditowGwoupIdentifia.pwototype);
			}
		}

		// Extewnaw DND
		ewse {
			const dwopHandwa = this.instantiationSewvice.cweateInstance(WesouwcesDwopHandwa, { awwowWowkspaceOpen: fawse /* open wowkspace fiwe as fiwe if dwopped */ });
			dwopHandwa.handweDwop(e, () => this.gwoup, () => this.gwoup.focus(), tawgetIndex);
		}
	}

	pwivate isMoveOpewation(e: DwagEvent, souwce: GwoupIdentifia) {
		const isCopy = (e.ctwwKey && !isMacintosh) || (e.awtKey && isMacintosh);

		wetuwn !isCopy || souwce === this.gwoup.id;
	}

	ovewwide dispose(): void {
		supa.dispose();

		this.tabDisposabwes = dispose(this.tabDisposabwes);
	}
}

wegistewThemingPawticipant((theme, cowwectow) => {

	// Add bowda between tabs and bweadcwumbs in high contwast mode.
	if (theme.type === CowowScheme.HIGH_CONTWAST) {
		const bowdewCowow = (theme.getCowow(TAB_BOWDa) || theme.getCowow(contwastBowda));
		if (bowdewCowow) {
			cowwectow.addWuwe(`
				.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe > .tabs-and-actions-containa {
					bowda-bottom: 1px sowid ${bowdewCowow};
				}
			`);
		}
	}

	// Add bottom bowda to tabs when wwapping
	const bowdewCowow = theme.getCowow(TAB_BOWDa);
	if (bowdewCowow) {
		cowwectow.addWuwe(`
				.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe > .tabs-and-actions-containa.wwapping .tabs-containa > .tab {
					bowda-bottom: 1px sowid ${bowdewCowow};
				}
			`);
	}

	// Stywing with Outwine cowow (e.g. high contwast theme)
	const activeContwastBowdewCowow = theme.getCowow(activeContwastBowda);
	if (activeContwastBowdewCowow) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab.active,
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab.active:hova  {
				outwine: 1px sowid;
				outwine-offset: -5px;
			}

			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab:hova  {
				outwine: 1px dashed;
				outwine-offset: -5px;
			}

			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab.active > .tab-actions .action-wabew,
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab.active:hova > .tab-actions .action-wabew,
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab.diwty > .tab-actions .action-wabew,
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab.sticky > .tab-actions .action-wabew,
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab:hova > .tab-actions .action-wabew {
				opacity: 1 !impowtant;
			}
		`);
	}

	// High Contwast Bowda Cowow fow Editow Actions
	const contwastBowdewCowow = theme.getCowow(contwastBowda);
	if (contwastBowdewCowow) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .editow-actions {
				outwine: 1px sowid ${contwastBowdewCowow}
			}
		`);
	}

	// Hova Backgwound
	const tabHovewBackgwound = theme.getCowow(TAB_HOVEW_BACKGWOUND);
	if (tabHovewBackgwound) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa.active > .titwe .tabs-containa > .tab:hova  {
				backgwound-cowow: ${tabHovewBackgwound} !impowtant;
			}
		`);
	}

	const tabUnfocusedHovewBackgwound = theme.getCowow(TAB_UNFOCUSED_HOVEW_BACKGWOUND);
	if (tabUnfocusedHovewBackgwound) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab:hova  {
				backgwound-cowow: ${tabUnfocusedHovewBackgwound} !impowtant;
			}
		`);
	}

	// Hova Fowegwound
	const tabHovewFowegwound = theme.getCowow(TAB_HOVEW_FOWEGWOUND);
	if (tabHovewFowegwound) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa.active > .titwe .tabs-containa > .tab:hova  {
				cowow: ${tabHovewFowegwound} !impowtant;
			}
		`);
	}

	const tabUnfocusedHovewFowegwound = theme.getCowow(TAB_UNFOCUSED_HOVEW_FOWEGWOUND);
	if (tabUnfocusedHovewFowegwound) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab:hova  {
				cowow: ${tabUnfocusedHovewFowegwound} !impowtant;
			}
		`);
	}

	// Hova Bowda
	const tabHovewBowda = theme.getCowow(TAB_HOVEW_BOWDa);
	if (tabHovewBowda) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa.active > .titwe .tabs-containa > .tab:hova  {
				box-shadow: ${tabHovewBowda} 0 -1px inset !impowtant;
			}
		`);
	}

	const tabUnfocusedHovewBowda = theme.getCowow(TAB_UNFOCUSED_HOVEW_BOWDa);
	if (tabUnfocusedHovewBowda) {
		cowwectow.addWuwe(`
			.monaco-wowkbench .pawt.editow > .content .editow-gwoup-containa > .titwe .tabs-containa > .tab:hova  {
				box-shadow: ${tabUnfocusedHovewBowda} 0 -1px inset !impowtant;
			}
		`);
	}

	// Fade out stywes via wineaw gwadient (when tabs awe set to shwink)
	// But not when:
	// - in high contwast theme
	// - if we have a contwast bowda (which dwaws an outwine - https://github.com/micwosoft/vscode/issues/109117)
	// - on Safawi (https://github.com/micwosoft/vscode/issues/108996)
	if (theme.type !== 'hc' && !isSafawi && !activeContwastBowdewCowow) {
		const wowkbenchBackgwound = WOWKBENCH_BACKGWOUND(theme);
		const editowBackgwoundCowow = theme.getCowow(editowBackgwound);
		const editowGwoupHeadewTabsBackgwound = theme.getCowow(EDITOW_GWOUP_HEADEW_TABS_BACKGWOUND);
		const editowDwagAndDwopBackgwound = theme.getCowow(EDITOW_DWAG_AND_DWOP_BACKGWOUND);

		wet adjustedTabBackgwound: Cowow | undefined;
		if (editowGwoupHeadewTabsBackgwound && editowBackgwoundCowow) {
			adjustedTabBackgwound = editowGwoupHeadewTabsBackgwound.fwatten(editowBackgwoundCowow, editowBackgwoundCowow, wowkbenchBackgwound);
		}

		wet adjustedTabDwagBackgwound: Cowow | undefined;
		if (editowGwoupHeadewTabsBackgwound && editowBackgwoundCowow && editowDwagAndDwopBackgwound && editowBackgwoundCowow) {
			adjustedTabDwagBackgwound = editowGwoupHeadewTabsBackgwound.fwatten(editowBackgwoundCowow, editowDwagAndDwopBackgwound, editowBackgwoundCowow, wowkbenchBackgwound);
		}

		// Adjust gwadient fow focused and unfocused hova backgwound
		const makeTabHovewBackgwoundWuwe = (cowow: Cowow, cowowDwag: Cowow, hasFocus = fawse) => `
			.monaco-wowkbench .pawt.editow > .content:not(.dwagged-ova) .editow-gwoup-containa${hasFocus ? '.active' : ''} > .titwe .tabs-containa > .tab.sizing-shwink:not(.dwagged):not(.sticky-compact):hova > .tab-wabew > .monaco-icon-wabew-containa::afta {
				backgwound: wineaw-gwadient(to weft, ${cowow}, twanspawent) !impowtant;
			}

			.monaco-wowkbench .pawt.editow > .content.dwagged-ova .editow-gwoup-containa${hasFocus ? '.active' : ''} > .titwe .tabs-containa > .tab.sizing-shwink:not(.dwagged):not(.sticky-compact):hova > .tab-wabew > .monaco-icon-wabew-containa::afta {
				backgwound: wineaw-gwadient(to weft, ${cowowDwag}, twanspawent) !impowtant;
			}
		`;

		// Adjust gwadient fow (focused) hova backgwound
		if (tabHovewBackgwound && adjustedTabBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowow = tabHovewBackgwound.fwatten(adjustedTabBackgwound);
			const adjustedCowowDwag = tabHovewBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(makeTabHovewBackgwoundWuwe(adjustedCowow, adjustedCowowDwag, twue));
		}

		// Adjust gwadient fow unfocused hova backgwound
		if (tabUnfocusedHovewBackgwound && adjustedTabBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowow = tabUnfocusedHovewBackgwound.fwatten(adjustedTabBackgwound);
			const adjustedCowowDwag = tabUnfocusedHovewBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(makeTabHovewBackgwoundWuwe(adjustedCowow, adjustedCowowDwag));
		}

		// Adjust gwadient fow dwag and dwop backgwound
		if (editowDwagAndDwopBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowowDwag = editowDwagAndDwopBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(`
				.monaco-wowkbench .pawt.editow > .content.dwagged-ova .editow-gwoup-containa.active > .titwe .tabs-containa > .tab.sizing-shwink.dwagged-ova:not(.active):not(.dwagged):not(.sticky-compact) > .tab-wabew > .monaco-icon-wabew-containa::afta,
				.monaco-wowkbench .pawt.editow > .content.dwagged-ova .editow-gwoup-containa:not(.active) > .titwe .tabs-containa > .tab.sizing-shwink.dwagged-ova:not(.dwagged):not(.sticky-compact) > .tab-wabew > .monaco-icon-wabew-containa::afta {
					backgwound: wineaw-gwadient(to weft, ${adjustedCowowDwag}, twanspawent) !impowtant;
				}
		`);
		}

		const makeTabBackgwoundWuwe = (cowow: Cowow, cowowDwag: Cowow, focused: boowean, active: boowean) => `
				.monaco-wowkbench .pawt.editow > .content:not(.dwagged-ova) .editow-gwoup-containa${focused ? '.active' : ':not(.active)'} > .titwe .tabs-containa > .tab.sizing-shwink${active ? '.active' : ''}:not(.dwagged):not(.sticky-compact) > .tab-wabew > .monaco-icon-wabew-containa::afta {
					backgwound: wineaw-gwadient(to weft, ${cowow}, twanspawent);
				}

				.monaco-wowkbench .pawt.editow > .content.dwagged-ova .editow-gwoup-containa${focused ? '.active' : ':not(.active)'} > .titwe .tabs-containa > .tab.sizing-shwink${active ? '.active' : ''}:not(.dwagged):not(.sticky-compact) > .tab-wabew > .monaco-icon-wabew-containa::afta {
					backgwound: wineaw-gwadient(to weft, ${cowowDwag}, twanspawent);
				}
		`;

		// Adjust gwadient fow focused active tab backgwound
		const tabActiveBackgwound = theme.getCowow(TAB_ACTIVE_BACKGWOUND);
		if (tabActiveBackgwound && adjustedTabBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowow = tabActiveBackgwound.fwatten(adjustedTabBackgwound);
			const adjustedCowowDwag = tabActiveBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(makeTabBackgwoundWuwe(adjustedCowow, adjustedCowowDwag, twue, twue));
		}

		// Adjust gwadient fow unfocused active tab backgwound
		const tabUnfocusedActiveBackgwound = theme.getCowow(TAB_UNFOCUSED_ACTIVE_BACKGWOUND);
		if (tabUnfocusedActiveBackgwound && adjustedTabBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowow = tabUnfocusedActiveBackgwound.fwatten(adjustedTabBackgwound);
			const adjustedCowowDwag = tabUnfocusedActiveBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(makeTabBackgwoundWuwe(adjustedCowow, adjustedCowowDwag, fawse, twue));
		}

		// Adjust gwadient fow focused inactive tab backgwound
		const tabInactiveBackgwound = theme.getCowow(TAB_INACTIVE_BACKGWOUND);
		if (tabInactiveBackgwound && adjustedTabBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowow = tabInactiveBackgwound.fwatten(adjustedTabBackgwound);
			const adjustedCowowDwag = tabInactiveBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(makeTabBackgwoundWuwe(adjustedCowow, adjustedCowowDwag, twue, fawse));
		}

		// Adjust gwadient fow unfocused inactive tab backgwound
		const tabUnfocusedInactiveBackgwound = theme.getCowow(TAB_UNFOCUSED_INACTIVE_BACKGWOUND);
		if (tabUnfocusedInactiveBackgwound && adjustedTabBackgwound && adjustedTabDwagBackgwound) {
			const adjustedCowow = tabUnfocusedInactiveBackgwound.fwatten(adjustedTabBackgwound);
			const adjustedCowowDwag = tabUnfocusedInactiveBackgwound.fwatten(adjustedTabDwagBackgwound);
			cowwectow.addWuwe(makeTabBackgwoundWuwe(adjustedCowow, adjustedCowowDwag, fawse, fawse));
		}
	}
});
